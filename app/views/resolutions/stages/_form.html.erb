<%= simple_form_for @stage, html: { autocomplete: "off"}, url: @stage.persisted? ? resolution_stage_path(resolution_id: @resolution.id, id: @stage.id) : resolution_stages_path(resolution_id: @resolution.id), data: { turbo: true } do |f| %>
  <%= f.error_notification %>

  <%= f.input :stage_id, collection: Stage.all.map{|s| [s.name, s.id]}, input_html: {data: { action: "input->toggle#changed", target: "toggle.element" }} %>
  <label class="dateLabel">Date</label>
  <%= f.input :date, as: :string, label: false, placeholder: "Select date...", input_html: { class: "datepicker", value: @stage.persisted? ? @stage.date.present? ? @stage.date.strftime("%B %e, %Y") : Time.now.strftime("%B %e, %Y") : Time.now.strftime("%B %e, %Y") } %>
  <div class="effDate">
    <%= f.input :effectivity_date, as: :string, label: "Date Enacted", placeholder: "Select date...", input_html: { class: "datepicker", value: @stage.persisted? ? @stage.effectivity_date.present? ? @stage.effectivity_date.strftime("%B %e, %Y") : Time.now.strftime("%B %e, %Y") : Time.now.strftime("%B %e, %Y") } %>
  </div>

  <%= f.submit "Save", class: "btn btn-outline-success float-right", data: { disable_with: "Processing..." } %>
<% end %>

<script type="text/javascript">
  $(function() {
    $('.effDate').hide(); 
    $('.stageSelect').change(function(){
      if($('.stageSelect').val() == '5' || $('.stageSelect').val() == '7') {
        $('.effDate').show(); 
        $('.dateLabel').text('Date Approved')
      } else {
        $('.effDate').hide(); 
        $('.dateLabel').text('Date')
      } 
    });
  });
</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('.datepicker').flatpickr({
      dateFormat: "F j, Y"
    });
  });
</script>