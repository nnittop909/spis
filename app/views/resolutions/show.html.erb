<div class="card shadow mb-4">
	<div class="card-header py-3">
		<div class="row">
			<div class="col-md-4">
				<h2 class="font-weight-bold text-primary">Resolution # <%= @resolution.number %></h2>
		    <span class="badge bg-info"><%= @resolution.current_stage.titleize if @resolution.current_stage.present? %></span>
		    <span class="badge bg-info"><%= @resolution.date_approved if @resolution.stages.present? %></span>
			</div>
			<div class="col-md-8">
				<% if current_user_admin? %>
					<ul class="nav nav-pills justify-content-end">
						<li class="nav-item px-2">
					    <%= link_to 'Update Status', @resolution.stagings.present? ? edit_resolution_stage_path(resolution_id: @resolution.id, id: @resolution.stagings.last.id) : new_resolution_stage_path(@resolution), class: "btn btn-secondary btn-sm", remote: true, data: { toggle: "modal", target: '#remote-modal', backdrop: 'static', keyboard: false } %>
					  </li>
					  <li class="nav-item px-2">
					    <div class="btn-group">
			          <button type="button" class="btn btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			            Add Authors
			          </button>
			          <div class="dropdown-menu">
			          	<%= link_to 'Principal Authors', new_resolution_authorships_author_path(resolution_id: @resolution.id), class: "dropdown-item", remote: true, data: { toggle: "modal", target: '#remote-modal', backdrop: 'static', keyboard: false } %>
			          	<%= link_to 'Co Authors', new_resolution_authorships_co_author_path(resolution_id: @resolution.id), class: "dropdown-item", remote: true, data: { toggle: "modal", target: '#remote-modal', backdrop: 'static', keyboard: false } %>
			          	<div class="dropdown-divider"></div>
			          	<%= link_to 'Single Author', new_resolution_author_path(@resolution), class: "dropdown-item", remote: true, data: { toggle: "modal", target: '#remote-modal', backdrop: 'static', keyboard: false } %>
			          </div>
			        </div>
					  </li>
					  <li class="nav-item px-2">
					    <%= link_to 'Add Sponsor', new_resolution_sponsor_path(@resolution), class: "btn btn-secondary btn-sm", remote: true, data: { toggle: "modal", target: '#remote-modal', backdrop: 'static', keyboard: false } %>
					  </li>
					  <li class="nav-item px-2">
					  	<%= link_to "Update Details", edit_resolution_path(@resolution), class: "btn btn-primary btn-sm float-right", remote: true, data: { toggle: "modal", target: '#remote-modal', backdrop: 'static', keyboard: false } %>
					  </li>
					</ul>
					<%#= link_to "Status Logs", resolution_stages_path(resolution_id: @resolution.id), class: 'float-right mr-3 mt-3' %>
				<% end %>
			</div>
		</div>
	</div>
	<div class="card-body">
		<table class="table">
			<tbody>
		  	<tr>
		      <td class="col-md-2 text-muted">Title</td>
		  		<td><%= @resolution.title %></td>
		  	</tr>
		  	<tr>
		      <td class="col-md-2 text-muted">Date Recieved</td>
		  		<td><%= @resolution.date.strftime("%B %e, %Y") if @resolution.date.present? %></td>
		  	</tr>
		  	<tr>
		      <td class="col-md-2 text-muted">Authors</td>
		  		<td>
		  			<% if @principal_authors.present? %>
			  			<p class="text-muted mb-1">Principal-Authors</p>
			  			<% @principal_authors.each do |author| %>
		  					<%= author.name_in_honorifics %>
				  			<span class="float-right">
				  				<% if current_user_admin? %>
					  				<%= link_to "Edit", edit_resolution_author_path(resolution_id: @resolution.id, id: @resolution.authorships.where(author_id: author.id).last.id), class: 'd-inline', remote: true, data: { toggle: "modal", target: '#remote-modal', backdrop: 'static', keyboard: false } %> | 
					  				<%= button_to "Delete", resolution_author_path(resolution_id: @resolution.id, id: @resolution.authorships.where(author_id: author.id).last.id), method: :delete, data: {confirm: "Are you sure?"}, form: { class: 'd-inline'}, class: 'btn btn-link' %>
					  			<% end %>
				  			</span>
				  			<hr class="my-1">
				  		<% end %>
				  	<% end %>
					  <% if @co_authors.present? %>
			  			<p class="text-muted mb-1 mt-3">Co-Authors</p>
			  			<% @co_authors.each do |author| %>
		  					<%= author.name_in_honorifics %>
				  			<span class="float-right">
				  				<% if current_user_admin? %>
					  				<%= link_to "Edit", edit_resolution_author_path(resolution_id: @resolution.id, id: @resolution.authorships.where(author_id: author.id).last.id), class: 'd-inline', remote: true, data: { toggle: "modal", target: '#remote-modal', backdrop: 'static', keyboard: false } %> | 
					  				<%= button_to "Delete", resolution_author_path(resolution_id: @resolution.id, id: @resolution.authorships.where(author_id: author.id).last.id), method: :delete, data: {confirm: "Are you sure?"}, form: { class: 'd-inline'}, class: 'btn btn-link' %>
					  			<% end %>
				  			</span>
				  			<hr class="my-1">
				  		<% end %>
				  	<% end %>
		  		</td>
		  	</tr>
		  	<tr>
		      <td class="col-md-2 text-muted">Sponsors</td>
		  		<td>
		  			<% @sponsors.each do |sponsor| %>
	  					<%= sponsor.name %>
			  			<span class="float-right">
			  				<% if current_user_admin? %>
				  				<%= link_to "Edit", edit_resolution_sponsor_path(resolution_id: @resolution.id, id: @resolution.sponsorships.where(sponsor_id: sponsor.id).last.id), class: 'd-inline', class: 'd-inline', remote: true, data: { toggle: "modal", target: '#remote-modal', backdrop: 'static', keyboard: false } %> | 
				  				<%= button_to "Delete", resolution_sponsor_path(resolution_id: @resolution.id, id: @resolution.sponsorships.where(sponsor_id: sponsor.id).last.id), method: :delete, data: {confirm: "Are you sure?"}, form: { class: 'd-inline'}, class: 'btn btn-link' %>
				  			<% end %>
			  			</span>
			  			<hr>
			  		<% end %>		  				
		  		</td>
		  	</tr>
		  	<tr>
		      <td class="col-md-2 text-muted">Remarks</td>
		  		<td><%= @resolution.remarks %></td>
		  	</tr>
		  	<tr>
		      <td class="col-md-2 text-muted">Attached Documents</td>
		      <td>
		      	<%= simple_form_for @resolution.documents.new, url: resolution_documents_path(resolution_id: @resolution.id), html: {multipart: true }, method: :post do |f| %>
		          <%= f.input :document_file, label: false, input_html: { multipart: true, onchange: "this.form.submit();" } %>
		        <% end if current_user_admin? %>
		  			<% if @resolution.documents.present? %>
		  				<% @resolution.documents.each do |document| %>
		  					<% if document.document_file.attached? %>
				  				<%= link_to document.name, rails_blob_path(document.document_file, disposition: "inline"), target: "_blank" %>
				  				<span class="float-right">
				  					<%= button_to "Delete", resolution_document_path(resolution_id: @resolution.id, id: document.id), method: :delete, data: {confirm: "Are you sure?"}, form: { class: 'd-inline'}, class: 'btn btn-link' if current_user_admin? %>
				  				</span> <br>
				  			<% end %>
			  			<% end %>
			  		<% end %>
			  	</td>
		  	</tr>
		  </tbody>
		</table>
	</div>
</div>