function camelize(e){return e.replace(/(?:[_-])([a-z0-9])/g,((e,t)=>t.toUpperCase()))}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function dasherize(e){return e.replace(/([A-Z])/g,((e,t)=>`-${t.toLowerCase()}`))}function readInheritableStaticArrayValues(e,t){const n=getAncestorsForConstructor(e);return Array.from(n.reduce(((e,n)=>{getOwnStaticArrayValues(n,t).forEach((t=>e.add(t)));return e}),new Set))}function readInheritableStaticObjectPairs(e,t){const n=getAncestorsForConstructor(e);return n.reduce(((e,n)=>{e.push(...getOwnStaticObjectPairs(n,t));return e}),[])}function getAncestorsForConstructor(e){const t=[];while(e){t.push(e);e=Object.getPrototypeOf(e)}return t.reverse()}function getOwnStaticArrayValues(e,t){const n=e[t];return Array.isArray(n)?n:[]}function getOwnStaticObjectPairs(e,t){const n=e[t];return n?Object.keys(n).map((e=>[e,n[e]])):[]}(()=>{function extendWithReflect(e){function extended(){return Reflect.construct(e,arguments,new.target)}extended.prototype=Object.create(e.prototype,{constructor:{value:extended}});Reflect.setPrototypeOf(extended,e);return extended}function testReflectExtension(){const a=function(){this.a.call(this)};const e=extendWithReflect(a);e.prototype.a=function(){};return new e}try{testReflectExtension();return extendWithReflect}catch(e){return e=>class extended extends e{}}})();function ClassPropertiesBlessing(e){const t=readInheritableStaticArrayValues(e,"classes");return t.reduce(((e,t)=>Object.assign(e,propertiesForClassDefinition(t))),{})}function propertiesForClassDefinition(e){return{[`${e}Class`]:{get(){const{classes:t}=this;if(t.has(e))return t.get(e);{const n=t.getAttributeName(e);throw new Error(`Missing attribute "${n}"`)}}},[`${e}Classes`]:{get(){return this.classes.getAll(e)}},[`has${capitalize(e)}Class`]:{get(){return this.classes.has(e)}}}}function TargetPropertiesBlessing(e){const t=readInheritableStaticArrayValues(e,"targets");return t.reduce(((e,t)=>Object.assign(e,propertiesForTargetDefinition(t))),{})}function propertiesForTargetDefinition(e){return{[`${e}Target`]:{get(){const t=this.targets.find(e);if(t)return t;throw new Error(`Missing target element "${e}" for "${this.identifier}" controller`)}},[`${e}Targets`]:{get(){return this.targets.findAll(e)}},[`has${capitalize(e)}Target`]:{get(){return this.targets.has(e)}}}}function ValuePropertiesBlessing(e){const t=readInheritableStaticObjectPairs(e,"values");const n={valueDescriptorMap:{get(){return t.reduce(((e,t)=>{const n=parseValueDefinitionPair(t);const s=this.data.getAttributeNameForKey(n.key);return Object.assign(e,{[s]:n})}),{})}}};return t.reduce(((e,t)=>Object.assign(e,propertiesForValueDefinitionPair(t))),n)}function propertiesForValueDefinitionPair(e){const t=parseValueDefinitionPair(e);const{key:n,name:s,reader:r,writer:i}=t;return{[s]:{get(){const e=this.data.get(n);return null!==e?r(e):t.defaultValue},set(e){void 0===e?this.data.delete(n):this.data.set(n,i(e))}},[`has${capitalize(s)}`]:{get(){return this.data.has(n)||t.hasCustomDefaultValue}}}}function parseValueDefinitionPair([e,t]){return valueDescriptorForTokenAndTypeDefinition(e,t)}function parseValueTypeConstant(e){switch(e){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function parseValueTypeDefault(e){switch(typeof e){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}return Array.isArray(e)?"array":"[object Object]"===Object.prototype.toString.call(e)?"object":void 0}function parseValueTypeObject(e){const t=parseValueTypeConstant(e.type);if(t){const n=parseValueTypeDefault(e.default);if(t!==n)throw new Error(`Type "${t}" must match the type of the default value. Given default value: "${e.default}" as "${n}"`);return t}}function parseValueTypeDefinition(e){const t=parseValueTypeObject(e);const n=parseValueTypeDefault(e);const s=parseValueTypeConstant(e);const r=t||n||s;if(r)return r;throw new Error(`Unknown value type "${e}"`)}function defaultValueForDefinition(t){const n=parseValueTypeConstant(t);if(n)return e[n];const s=t.default;return void 0!==s?s:t}function valueDescriptorForTokenAndTypeDefinition(e,s){const r=`${dasherize(e)}-value`;const i=parseValueTypeDefinition(s);return{type:i,key:r,name:camelize(r),get defaultValue(){return defaultValueForDefinition(s)},get hasCustomDefaultValue(){return void 0!==parseValueTypeDefault(s)},reader:t[i],writer:n[i]||n.default}}const e={get array(){return[]},boolean:false,number:0,get object(){return{}},string:""};const t={array(e){const t=JSON.parse(e);if(!Array.isArray(t))throw new TypeError("Expected array");return t},boolean(e){return!("0"==e||"false"==e)},number(e){return Number(e)},object(e){const t=JSON.parse(e);if(null===t||"object"!=typeof t||Array.isArray(t))throw new TypeError("Expected object");return t},string(e){return e}};const n={default:writeString,array:writeJSON,object:writeJSON};function writeJSON(e){return JSON.stringify(e)}function writeString(e){return`${e}`}class Controller{constructor(e){this.context=e}static get shouldLoad(){return true}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(e,{target:t=this.element,detail:n={},prefix:s=this.identifier,bubbles:r=true,cancelable:i=true}={}){const o=s?`${s}:${e}`:e;const l=new CustomEvent(o,{detail:n,bubbles:r,cancelable:i});t.dispatchEvent(l);return l}}Controller.blessings=[ClassPropertiesBlessing,TargetPropertiesBlessing,ValuePropertiesBlessing];Controller.targets=[];Controller.values={};class RevealController extends Controller{static values={open:Boolean,transitioning:Boolean,targetSelector:String,toggleKeys:String,showKeys:String,hideKeys:String,away:Boolean,debug:Boolean};connect(){this._initCloseKeypressListener();this._initToggleKeypressListener();this._initShowKeypressListener();this._awayHandler=this._awayHandler.bind(this)}disconnect(){this._teardown()}show(e){this.openValue||this.transitioningValue||this._init(e,true)}hide(e){this.openValue&&!this.transitioningValue&&this._init(e,false)}toggle(e){this.transitioningValue||this._init(e,!this.openValue)}stop(e){e.stopPropagation()}async _init(e,t){if(e&&e.currentTarget&&e.currentTarget.dataset){"revealPreventDefault"in e.currentTarget.dataset&&e.preventDefault();"revealStopPropagation"in e.currentTarget.dataset&&e.stopPropagation()}const n=`${this.selector}[data-${t?"enter":"leave"}-start]`;const s=this._didInitWithPromise(n,t);await Promise.all(s);const r=`${this.selector}:not([data-${t?"enter":"leave"}-start]):not([data-${t?"enter":"leave"}-end])`;const i=this._didInitWithPromise(r,t);await Promise.all(i);const o=`${this.selector}[data-${t?"enter":"leave"}-end]`;const l=this._didInitWithPromise(o,t);await Promise.all(l)}_teardown(){this.hasAwayValue&&document.removeEventListener("click",this._awayHandler)}_didInitWithPromise(e,t){this._debug("selecting",e,this._fetchElements(e));return this._fetchElements(e).map((e=>this._doInitTransition(e,t)))}_initCloseKeypressListener(){this.hasHideKeysValue&&document.addEventListener("keydown",(e=>{if(this.openValue&&this.hideKeysValue.split(",").includes(e.key.toLowerCase())){e.stopPropagation();this.toggle(e)}}))}_initToggleKeypressListener(){this.hasToggleKeysValue&&document.addEventListener("keydown",(e=>{if(this.toggleKeysValue.split(",").includes(e.key.toLowerCase())){e.stopPropagation();this.toggle(e)}}))}_initShowKeypressListener(){this.hasShowKeysValue&&document.addEventListener("keydown",(e=>{if(!this.openValue&&this.showKeysValue.split(",").includes(e.key.toLowerCase())){e.stopPropagation();this.toggle(e)}}))}_awayHandler(e){if(!this.element.contains(e.target)){document.removeEventListener("click",this._awayHandler);this.hide(e)}return true}_doInitTransition(e,t){this._debug("init transition",""+(t?"open":"closed"),e);this._debug("dispatching event","reveal:"+(t?"show":"hide"),e);e.dispatchEvent(new Event("reveal:"+(t?"show":"hide"),{bubbles:true,cancelable:false}));return new Promise(((n,s)=>{if("transition"in e.dataset&&null!==this.element.offsetParent)requestAnimationFrame((()=>{this._transitionSetup(e,t);const s=this._didEndTransition.bind(this);e.addEventListener("transitionend",(function _didEndTransitionHandler(){s(e,t);e.removeEventListener("transitionend",_didEndTransitionHandler);n()}));requestAnimationFrame((()=>{this._doStartTransition(e,t)}))}));else{if(t){this._debug("force hidden - init",""+(t?"open":"closed"),e);e.hidden=!e.hidden}this._doCompleteTransition(e,t);n()}}))}_doStartTransition(e,t){this._debug("start transition",""+(t?"open":"closed"),e);this.transitioningValue=true;if("true"===e.dataset.useTransitionClasses){const t=this._transitionClasses(e,this.transitionType);e.classList.add(...t.end.split(" "));e.classList.remove(...t.start.split(" "))}else{const n=this._transitionDefaults(t);e.style.transformOrigin=n.origin;e.style.transitionProperty="opacity transform";e.style.transitionDuration=n.duration/1e3+"s";e.style.transitionTimingFunction="cubic-bezier(0.4, 0.0, 0.2, 1)";e.style.opacity=n.to.opacity;e.style.transform=`scale(${n.to.scale/100})`}}_didEndTransition(e,t){this._debug("end transition",""+(t?"open":"closed"),e);if("true"===e.dataset.useTransitionClasses){const t=this._transitionClasses(e,this.transitionType);e.classList.remove(...t.before.split(" "))}else{e.style.opacity=e.dataset.opacityCache;e.style.transform=e.dataset.transformCache;e.style.transformOrigin=e.dataset.transformOriginCache}this._doCompleteTransition(e,t)}_doCompleteTransition(e,t){this._debug("complete transition",""+(t?"open":"closed"),e);this.transitioningValue=false;if(!t){this._debug("force hidden - complete",""+(t?"open":"closed"),e);e.hidden=!e.hidden}this.openValue=t;this._debug("dispatching event","reveal:"+(t?"shown":"hidden"),e);e.dispatchEvent(new Event("reveal:"+(t?"shown":"hidden"),{bubbles:true,cancelable:false}));this.hasAwayValue&&t&&document.addEventListener("click",this._awayHandler);this._debug("dispatching event","reveal:complete",e);e.dispatchEvent(new Event("reveal:complete",{bubbles:true,cancelable:false}))}_transitionSetup(e,t){this.transitionType=t?"transitionEnter":"transitionLeave";if(this.transitionType in e.dataset){e.dataset.useTransitionClasses=true;const t=this._transitionClasses(e,this.transitionType);e.classList.add(...t.before.split(" "));e.classList.add(...t.start.split(" "))}else{e.dataset.useTransitionClasses=false;const n=this._transitionDefaults(t);e.dataset.opacityCache=e.style.opacity;e.dataset.transformCache=e.style.transform;e.dataset.transformOriginCache=e.style.transformOrigin;e.style.opacity=n.from.opacity;e.style.transform=`scale(${n.from.scale/100})`}if(t){this._debug("opening with transition",e);e.hidden=!e.hidden}}_transitionDefaults(e){return{duration:e?200:150,origin:"center",from:{opacity:e?0:1,scale:e?95:100},to:{opacity:e?1:0,scale:e?100:95}}}_transitionClasses(e,t){return{before:e.dataset[t],start:e.dataset[`${t}Start`],end:e.dataset[`${t}End`]}}_fetchElements(e){return[this.element,...this.element.querySelectorAll(e)].filter((t=>t.matches(e)))}_debug(...e){this.debugValue&&console.log(...e)}get selector(){return this.hasTargetSelectorValue?this.targetSelectorValue:"[data-reveal]"}}export{RevealController as default};

